<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Catch the Falling Objects</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: #111;
      font-family: Arial, sans-serif;
    }
    canvas {
      display: block;
      margin: auto;
      background: radial-gradient(circle at center, #222 0%, #000 100%);
    }
    #hud {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      color: white;
      font-size: 20px;
      text-align: center;
      z-index: 10;
      user-select: none;
    }
    #credits {
      position: absolute;
      bottom: 5px;
      right: 10px;
      color: #aaa;
      font-size: 14px;
      font-style: italic;
      z-index: 10;
      user-select: none;
    }
  </style>
</head>
<body>
  <div id="hud">Score: 0 | High Score: 0</div>
  <div id="credits">Made by ChatGPT &amp; Bomennugget</div>
  <canvas id="gameCanvas" width="500" height="600"></canvas>

  <!-- Audio elements -->
  <audio id="catchSound" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg" preload="auto"></audio>
  <audio id="missSound" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg" preload="auto"></audio>
  <audio id="bgMusic" src="https://cdn.pixabay.com/download/audio/2023/03/05/audio_4bb6cb097c.mp3?filename=arcade-music-loop-147085.mp3" loop preload="auto"></audio>
  <audio id="secretSound" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg" preload="auto"></audio>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const hud = document.getElementById('hud');

    let basket = { x: canvas.width / 2 - 40, y: canvas.height - 40, width: 80, height: 20, speed: 8 };
    let balls = [];
    let score = 0;
    let highScore = parseInt(localStorage.getItem('catchHighScore')) || 0;
    let gameOver = false;
    let level = 1;
    let secretsUnlocked = [];
    let lives = 3;

    const catchSound = document.getElementById('catchSound');
    const missSound = document.getElementById('missSound');
    const bgMusic = document.getElementById('bgMusic');
    const secretSound = document.getElementById('secretSound');
    bgMusic.volume = 0.3;
    bgMusic.play().catch(() => {});

    function drawBasket() {
      ctx.fillStyle = 'lime';
      ctx.fillRect(basket.x, basket.y, basket.width, basket.height);
      ctx.strokeStyle = '#0f0';
      ctx.lineWidth = 2;
      ctx.strokeRect(basket.x, basket.y, basket.width, basket.height);
    }

    function drawBall(ball) {
      ctx.beginPath();
      ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
      ctx.fillStyle = ball.color;
      ctx.fill();
      ctx.lineWidth = 2;
      ctx.strokeStyle = '#fff';
      ctx.stroke();
      ctx.closePath();
    }

    function newBall() {
      const x = Math.random() * (canvas.width - 20) + 10;
      const colors = ['red', 'yellow', 'cyan', 'magenta', 'orange', 'lime'];
      let special = Math.random() < 0.05; // 5% chance secret ball
      balls.push({
        x: x,
        y: 0,
        radius: 12,
        speed: 2 + Math.random() * (1 + level * 0.5),
        color: special ? 'gold' : colors[Math.floor(Math.random() * colors.length)],
        secret: special
      });
    }

    function updateBalls() {
      for (let i = 0; i < balls.length; i++) {
        let ball = balls[i];
        ball.y += ball.speed;

        // Collision with basket
        if (
          ball.y + ball.radius >= basket.y &&
          ball.x > basket.x &&
          ball.x < basket.x + basket.width
        ) {
          if (ball.secret) {
            unlockSecret();
          } else {
            score++;
            catchSound.currentTime = 0;
            catchSound.play().catch(() => {});
          }
          balls.splice(i, 1);
          i--;
          continue;
        }

        // Missed
        if (ball.y - ball.radius > canvas.height) {
          balls.splice(i, 1);
          i--;
          loseLife();
        }
      }
    }

    function loseLife() {
      lives--;
      missSound.currentTime = 0;
      missSound.play().catch(() => {});
      if (lives <= 0) {
        gameOver = true;
      }
    }

    function unlockSecret() {
      if (!secretsUnlocked.includes('goldenBall')) {
        secretsUnlocked.push('goldenBall');
        secretSound.currentTime = 0;
        secretSound.play().catch(() => {});
        score += 10;
      } else {
        score += 5;
      }
    }

    function updateHUD() {
      let secretText = secretsUnlocked.length > 0 ? ` | Secrets: ${secretsUnlocked.length}` : '';
      hud.textContent = `Score: ${score} | High Score: ${highScore} | Level: ${level} | Lives: ${lives}${secretText}`;
    }

    function gameLoop() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      if (gameOver) {
        if (score > highScore) {
          highScore = score;
          localStorage.setItem('catchHighScore', highScore);
        }
        updateHUD();
        ctx.fillStyle = 'white';
        ctx.font = '40px Arial';
        ctx.fillText('Game Over!', 140, 280);
        ctx.font = '20px Arial';
        ctx.fillText('Click, Tap, or Press Space to Restart', 70, 320);
        return;
      }

      drawBasket();
      balls.forEach(drawBall);
      updateBalls();

      // Level up every 10 points
      level = 1 + Math.floor(score / 10);

      updateHUD();
      requestAnimationFrame(gameLoop);
    }

    // Controls
    document.addEventListener('keydown', e => {
      if (e.key === 'ArrowLeft') {
        basket.x = Math.max(0, basket.x - basket.speed);
      } else if (e.key === 'ArrowRight') {
        basket.x = Math.min(canvas.width - basket.width, basket.x + basket.speed);
      } else if (e.key === ' ' && gameOver) {
        restartGame();
      }

      // Secret cheat code: press "S"
      if (e.key.toLowerCase() === 's') {
        unlockSecret();
      }
    });

    canvas.addEventListener('mousemove', e => {
      const mouseX = e.clientX - canvas.getBoundingClientRect().left;
      basket.x = Math.min(Math.max(mouseX - basket.width / 2, 0), canvas.width - basket.width);
    });

    canvas.addEventListener('touchmove', e => {
      const touchX = e.touches[0].clientX - canvas.getBoundingClientRect().left;
      basket.x = Math.min(Math.max(touchX - basket.width / 2, 0), canvas.width - basket.width);
    });

    canvas.addEventListener('click', () => {
      if (gameOver) restartGame();
    });

    function restartGame() {
      balls = [];
      score = 0;
      level = 1;
      lives = 3;
      gameOver = false;
      secretsUnlocked = [];
      gameLoop();
    }

    // Improved ball spawner scaling with level
    setInterval(() => {
      if (!gameOver) newBall();
    }, 1000);

    // Start
    gameLoop();
  </script>
</body>
</html>